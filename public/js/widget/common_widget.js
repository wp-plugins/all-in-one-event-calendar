timely.require(["scripts/calendar","scripts/event","scripts/common_scripts/frontend/common_frontend","domReady","jquery_timely","ai1ec_calendar","ai1ec_config","libs/utils","libs/gmaps"],function(e,t,n,r,i,s,o,u){if(window.timely.js_widgets_inited)return;window.timely.js_widgets_inited=1;var a='<h2 class="ai1ec-widget-loading ai1ec-text-center"><small>			<i class="ai1ec-fa ai1ec-fa-lg ai1ec-fa-fw ai1ec-fa-spin				ai1ec-fa-spinner"></i> '+o.calendar_loading+"</small></h2>",f=function(e){e.find(".ai1ec-widget-loading").fadeOut("slow",function(){i(this).remove()})},l=function(e){var t=o.javascript_widgets[e.widget];if(!t)return!1;var n=(e.widget.match(/superwidget/)?s.calendar_url:o.site_url)+"?ai1ec_js_widget="+e.widget+"&render=true";return i.each(t,function(t,r){undefined!==e[t]&&(n+="&"+t+"="+e[t])}),n},c=function(e,t,n,r){var s=i(this),t=t||s.attr("href");return type="jsonp",$timely_div=s.closest(".timely"),query={request_type:type,ai1ec_doing_ajax:!0,ai1ec:u.create_ai1ec_to_send($timely_div)},$modal=i("#ai1ec-event-modal"),$event=s.closest(".ai1ec-event").length?s.closest(".ai1ec-event"):s,n=n||$event.attr("class").match(/ai1ec-event-instance-id-(\d+)/)[1],r=r||function(){var e=t.match(/\/event\/([\w-]+)/);return e||(e=t.match(/\?ai1ec_event=([\w-]+)&/)),e?e[1]:undefined},eventURL="#event|"+r()+"|"+n,$modal.modal("show").find(".ai1ec-modal-body").html(a),i(".ai1ec-popup").hide(),location.hash!=eventURL&&History.pushState(n,r,eventURL),i.ajax({url:t,dataType:type,data:query,method:"get",crossDomain:!0,success:function(e){$modal.modal("show").find(".ai1ec-modal-body").append(e.html),i(".ai1ec-subscribe-container",$modal).hide(),i("a.ai1ec-category, a.ai1ec-tag",$modal).each(function(){i(this).removeAttr("href")}),i(".ai1ec-calendar-link",$modal).attr("data-dismiss","ai1ec-modal"),timely.require(["scripts/event"],function(e){e.start()})},complete:function(){f($modal)}}),!1},h=function(){i(".ai1ec-load-view, .ai1ec-clear-filter").each(function(){var e=i(this),t=e.closest(".timely-widget").attr("data-widget-type"),n=e.attr("href")||e.attr("data-href"),r=u.add_query_arg(n,["ai1ec_source",t]);e.attr({href:r,"data-href":r})})};r(function(){i("#ai1ec-event-modal").length||i("body").append('<div id="ai1ec-event-modal" class="timely ai1ec-modal ai1ec-fade"					role="dialog" aria-hidden="true" tabindex="-1">					<div class="ai1ec-modal-dialog">						<div class="ai1ec-modal-content">							<button data-dismiss="ai1ec-modal" class="ai1ec-close ai1ec-pull-right">&times;</button>							<div class="ai1ec-modal-body ai1ec-clearfix single-ai1ec_event">							</div>						</div>					</div>				</div>');var t=i('[data-widget^="ai1ec"]').not("[data-added]").map(function(t,n){var r=i(n),s=r.data("widget"),o=i("<div />",{"class":"timely timely-widget"+(s.match(/ai1ec(_|-)superwidget/)?" timely-calendar":"")}).attr("data-widget-type",s).html(a).insertAfter(r),h=l(r.data()),p={ai1ec_doing_ajax:!0,request_type:"jsonp",ai1ec:u.create_ai1ec_to_send(n),ai1ec_source:s};return!1===h?(r.remove(),o.remove(),!1):(o.on("click",".ai1ec-cog-item-name a",c),i.ajax({url:h,dataType:"jsonp",data:p,success:function(t){o.append(t.html),r.attr("data-added",1),e.initialize_view(o.find(".ai1ec-calendar"))},error:function(){o.append("<p>An error occurred while retrieving the data.</p>")},complete:function(){f(o)}}))}).get();i.when.apply(i,t).done(function(){n.are_event_listeners_attached()||n.start(),i.each(s.extension_urls,function(e,t){timely.require([t.url])}),h(),top.postMessage("ai1ec-widget-loaded",top.document.URL),i(document).trigger("page_ready.ai1ec").data("ai1ec-widget-loaded",1)});var r=document.title;i(document).on("click","a.ai1ec-load-event",c).on("initialize_view.ai1ec",h).on("hide.bs.modal","#ai1ec-event-modal",function(){location.hash&&history.pushState(null,r,location.pathname)});var p=function(){var e=location.hash;e=e.match(/event\|([\w-]+)\|(\d+)/),e?(event_name=function(){return e[1]},instance_id=e[2],s.permalinks_structure?href=o.site_url+"event/"+event_name()+"/?instance_id="+instance_id:href=o.site_url+"?ai1ec_event="+event_name()+"&instance_id="+instance_id,c(null,href,instance_id,event_name)):i("#ai1ec-event-modal").modal("hide")};p(),History.Adapter.bind(window,"popstate",function(e){e.originalEvent&&p()})})});